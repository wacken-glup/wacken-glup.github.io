import{P as $,L as j,H as C,k as P,_ as B,c as r,a as n,b as p,m as c,s as d,t as s,r as h,z as f,B as y,C as A,I as L,F as v,u as k,o as a}from"./index-D2vt1XXD.js";var g=(o=>(o.amber="Amber",o.blue="Blau",o["blue-grey"]="Blau-Grau",o.brown="Braun",o.cyan="Cyan",o["deep-orange"]="Deep-Orange",o["deep-purple"]="Deep-Purple",o.green="Grün",o.grey="Grau",o.indigo="Indigo",o["light-blue"]="Hellblau",o["light-green"]="Hellgrün",o.lime="Lime",o.orange="Orange",o.pink="Pink",o.purple="Purple",o.red="Rot",o.teal="Teal",o.yellow="Gelb",o))(g||{});const U={data(){return{name:void 0,host:void 0,space:void 0,key:void 0,page:0,secondaryPage:0,form:{name:void 0,color:void 0,error:void 0},loaded:!1,errorCode:void 0}},mounted(){var o,e,i,m,t;this.$ctx.dontAutoCreateSpace=!0,this.name=(o=this.$route.query.name)==null?void 0:o.toString(),this.host=(e=this.$route.query.host)==null?void 0:e.toString(),this.space=(i=this.$route.query.space)==null?void 0:i.toString(),this.key=(m=this.$route.query.key)==null?void 0:m.toString(),this.$route.query.page=="1"&&(this.page=1),this.form.name=((t=this.$ctx.currentUser.value)==null?void 0:t.displayName)||"",(async()=>{var u;for(;((u=this.$client.space)==null?void 0:u.loaded)!=!0;)await P(50);this.loaded=!0})()},methods:{async join(){try{this.$ctx.currentUser.value==null&&(this.$ctx.dontAutoCreateSpace=!0,this.$ctx.currentUser.value=(await C(this.$ctx.auth)).user),await this.$client.registerUser(this.space,this.key),window.location.href=window.location.href+"&page=1"}catch(o){o.code?this.errorCode=o.code:this.errorCode=o+"",console.error(o)}},async complete(){var o,e;try{if(this.space===void 0||this.key===void 0)throw"Der Einladungslink ist fehlerhaft.";if(this.form.name===void 0)throw"Bitte gebe deinen Namen an.";if(this.form.color===void 0)throw"Bitte wähle eine Farbe aus.";if(this.form.name.length<2)throw"Der Name muss aus mindestens zwei Zeichen bestehen.";if(this.form.name.length>48)throw"Bitte gebe eine kürzere Version deines Namens an.";if(this.form.color.length<2)throw"Bitte gebe eine gültige Farbe an.";this.form.error=void 0;try{let i=await((o=this.$client.space)==null?void 0:o.createMember(this.form.name,this.form.color));if(i==null)throw"CREATION_OF_MEMBER_FAILED";await((e=this.$client.space)==null?void 0:e.setMemberId(this.$ctx.currentUser.value.uid,i)),window.location.href="/"}catch(i){i.code?this.errorCode=i.code:this.errorCode=i+"",console.error(i)}}catch(i){this.form.error=i+""}},async chooseMember(o){var e;try{await((e=this.$client.space)==null?void 0:e.setMemberId(this.$ctx.currentUser.value.uid,o.id)),window.location.href="/"}catch(i){i.code?this.errorCode=i.code:this.errorCode=i+"",console.error(i)}},getAvailableColors(){var i;let o=[];(i=this.$client.space)==null||i.members.forEach(m=>{o.push(m.color)});let e=Object.keys(g).filter(m=>!o.includes(m));return e.length<3&&(e=Object.keys(g)),e},getColorLabel(o){return g[o]}},components:{LoginButtons:j,PrivacyPolicyLink:$}},D={class:"responsive max"},N={class:"middle-align",style:{height:"100%"}},E={class:"center middle-align center-align",style:{"padding-left":"24px","padding-right":"24px"}},I={class:"center-align"},S={key:0},V={key:1},O={key:2,class:"center-align"},F={key:3,class:"center-align"},q={class:"center-align"},z={class:"tabbed"},G={id:"join-form",onsubmit:"event.preventDefault()"},T={class:"field label prefix border"},H={class:"field label prefix suffix border"},R=["value"],Y={key:0,class:"error"},x={class:"right-align"},J={style:{"max-height":"50vh",overflow:"scroll"}},W=["onClick"],Z={class:"max"},K={class:"small"},Q={class:"link"},X={class:"right-align no-space"};function M(o,e,i,m,t,u){const w=h("LoginButtons"),b=h("PrivacyPolicyLink");return a(),r(v,null,[n("main",D,[n("div",N,[n("article",E,[n("div",null,[n("div",{class:d(["page",{active:t.page==0}])},[e[14]||(e[14]=n("i",{class:"extra"},"groups",-1)),n("h5",I,s(o.$t("join.title")),1),t.name!=null?(a(),r("p",S,s(o.$t("join.message.specific",{n:t.host||o.$t("common.someone"),s:t.name})),1)):c("",!0),t.name==null?(a(),r("p",V,s(o.$t("join.message.generic",{n:t.host||o.$t("common.someone")})),1)):c("",!0),e[15]||(e[15]=n("div",{class:"space"},null,-1)),o.$ctx.currentUser.value!==void 0?(a(),r("nav",O,[n("button",{class:"large",onClick:e[0]||(e[0]=l=>u.join())},[e[9]||(e[9]=n("i",null,"join",-1)),n("span",null,s(o.$t("common.join")),1)])])):c("",!0),o.$ctx.currentUser.value==null?(a(),r("div",F,[n("button",{class:"responsive",onClick:e[1]||(e[1]=l=>u.join())},[e[10]||(e[10]=n("i",null,"join",-1)),n("span",null,s(o.$t("join.button.joinWithoutAccount")),1)]),e[11]||(e[11]=n("div",{class:"space"},null,-1)),e[12]||(e[12]=n("div",{class:"divider"},null,-1)),e[13]||(e[13]=n("div",{class:"space"},null,-1)),p(w,{"hide-anon":!0,reload:!0})])):c("",!0)],2),t.loaded?(a(),r("div",{key:0,class:d(["page",{active:t.page==1}])},[e[23]||(e[23]=n("i",{class:"extra"},"label",-1)),n("h5",q,s(o.$t("join.whoAreYou.title")),1),n("p",null,[f(s(o.$t("join.whoAreYou.message[0]")),1),e[16]||(e[16]=n("br",null,null,-1)),f(s(o.$t("join.whoAreYou.message[1]")),1)]),e[24]||(e[24]=n("div",{class:"space"},null,-1)),e[25]||(e[25]=n("div",{class:"space"},null,-1)),n("nav",z,[n("a",{class:d({active:t.secondaryPage==0}),onClick:e[2]||(e[2]=l=>t.secondaryPage=0)},[e[17]||(e[17]=n("i",null,"add",-1)),n("span",null,s(o.$t("common.add")),1)],2),n("a",{class:d({active:t.secondaryPage==1}),onClick:e[3]||(e[3]=l=>t.secondaryPage=1)},[e[18]||(e[18]=n("i",null,"check_circle",-1)),n("span",null,s(o.$t("common.select")),1)],2)]),e[26]||(e[26]=n("div",{class:"space"},null,-1)),e[27]||(e[27]=n("div",{class:"space"},null,-1)),n("div",{class:d(["page left center-align",{active:t.secondaryPage==0}])},[n("form",G,[n("div",T,[e[19]||(e[19]=n("i",null,"label",-1)),y(n("input",{type:"name","onUpdate:modelValue":e[4]||(e[4]=l=>t.form.name=l)},null,512),[[A,t.form.name]]),n("label",null,s(o.$t("common.name")),1)]),n("div",H,[n("i",{class:d([`${t.form.color}-text`])},"palette",2),y(n("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>t.form.color=l)},[(a(!0),r(v,null,k(u.getAvailableColors(),l=>(a(),r("option",{value:l},s(u.getColorLabel(l)),9,R))),256))],512),[[L,t.form.color]]),n("label",null,s(o.$t("common.color")),1),e[20]||(e[20]=n("i",null,"arrow_drop_down",-1))])]),t.form.error!=null?(a(),r("p",Y,s(t.form.error),1)):c("",!0),n("nav",x,[n("button",{form:"join-form",onClick:e[6]||(e[6]=l=>u.complete())},[e[21]||(e[21]=n("i",null,"check",-1)),n("span",null,s(o.$t("common.finish")),1)])])],2),o.$client.space!=null?(a(),r("div",{key:0,class:d(["page right center-align",{active:t.secondaryPage==1}])},[n("article",J,[(a(!0),r(v,null,k(o.$client.space.members,l=>(a(),r(v,null,[l.isOwner()?c("",!0):(a(),r("a",{key:0,class:"row wave padding",onClick:_=>u.chooseMember(l)},[n("button",{class:d(["circle",[`${l.color}5`]])},e[22]||(e[22]=[n("i",{style:{color:"black"}},"person",-1)]),2),n("div",Z,[n("h6",K,s(l.name),1),n("div",null,[n("span",Q,s(o.$tc("common.likes",l.likes.length))+" "+s(o.$t("common.and"))+" "+s(o.$tc("common.recommendations",l.suggestions.length)),1)])])],8,W))],64))),256))])],2)):c("",!0)],2)):c("",!0)])])])]),p(b),n("div",{class:d(["overlay",{active:t.errorCode}]),onClick:e[7]||(e[7]=l=>t.errorCode=void 0)},null,2),n("dialog",{class:d(["error",{active:t.errorCode}])},[n("h5",null,s(o.$t("join.dialog.error.title")),1),n("div",null,s(o.$t("join.dialog.error.message"))+" "+s(t.errorCode),1),n("nav",X,[n("button",{class:"error-container no-elevate",onClick:e[8]||(e[8]=l=>t.errorCode=void 0)},s(o.$t("common.ok")),1)])],2)],64)}const oe=B(U,[["render",M]]);export{oe as default};
