import{P as $,L as j,H as C,l as P,_ as B,c as r,a as o,b as p,q as c,u as d,t as i,r as h,z as f,F as m,v as y,B as k,C as A,I as L,o as a}from"./index-BbP49QBZ.js";var g=(n=>(n.amber="Amber",n.blue="Blau",n["blue-grey"]="Blau-Grau",n.brown="Braun",n.cyan="Cyan",n["deep-orange"]="Deep-Orange",n["deep-purple"]="Deep-Purple",n.green="Grün",n.grey="Grau",n.indigo="Indigo",n["light-blue"]="Hellblau",n["light-green"]="Hellgrün",n.lime="Lime",n.orange="Orange",n.pink="Pink",n.purple="Purple",n.red="Rot",n.teal="Teal",n.yellow="Gelb",n))(g||{});const U={data(){return{name:void 0,host:void 0,space:void 0,key:void 0,page:0,secondaryPage:0,form:{name:void 0,color:void 0,error:void 0},loaded:!1,errorCode:void 0}},mounted(){var n,e,t,v,s;this.$ctx.dontAutoCreateSpace=!0,this.name=(n=this.$route.query.name)==null?void 0:n.toString(),this.host=(e=this.$route.query.host)==null?void 0:e.toString(),this.space=(t=this.$route.query.space)==null?void 0:t.toString(),this.key=(v=this.$route.query.key)==null?void 0:v.toString(),this.$route.query.page=="1"&&(this.page=1),this.form.name=((s=this.$ctx.currentUser.value)==null?void 0:s.displayName)||"",(async()=>{var u;for(;((u=this.$client.space)==null?void 0:u.loaded)!=!0;)await P(50);this.loaded=!0})()},methods:{async join(){try{this.$ctx.currentUser.value==null&&(this.$ctx.dontAutoCreateSpace=!0,this.$ctx.currentUser.value=(await C(this.$ctx.auth)).user),await this.$client.registerUser(this.space,this.key),window.location.href=window.location.href+"&page=1"}catch(n){n.code?this.errorCode=n.code:this.errorCode=n+"",console.error(n)}},async complete(){var n,e;try{if(this.space===void 0||this.key===void 0)throw"Der Einladungslink ist fehlerhaft.";if(this.form.name===void 0)throw"Bitte gebe deinen Namen an.";if(this.form.color===void 0)throw"Bitte wähle eine Farbe aus.";if(this.form.name.length<2)throw"Der Name muss aus mindestens zwei Zeichen bestehen.";if(this.form.name.length>48)throw"Bitte gebe eine kürzere Version deines Namens an.";if(this.form.color.length<2)throw"Bitte gebe eine gültige Farbe an.";this.form.error=void 0;try{let t=await((n=this.$client.space)==null?void 0:n.createMember(this.form.name,this.form.color));if(t==null)throw"CREATION_OF_MEMBER_FAILED";await((e=this.$client.space)==null?void 0:e.setMemberId(this.$ctx.currentUser.value.uid,t)),window.location.href="/"}catch(t){t.code?this.errorCode=t.code:this.errorCode=t+"",console.error(t)}}catch(t){this.form.error=t+""}},async chooseMember(n){var e;try{await((e=this.$client.space)==null?void 0:e.setMemberId(this.$ctx.currentUser.value.uid,n.id)),window.location.href="/"}catch(t){t.code?this.errorCode=t.code:this.errorCode=t+"",console.error(t)}},getAvailableColors(){var t;let n=[];(t=this.$client.space)==null||t.members.forEach(v=>{n.push(v.color)});let e=Object.keys(g).filter(v=>!n.includes(v));return e.length<3&&(e=Object.keys(g)),e},getColorLabel(n){return g[n]}},components:{LoginButtons:j,PrivacyPolicyLink:$}},D={class:"responsive max"},N={class:"middle-align",style:{height:"100%"}},E={class:"center middle-align center-align",style:{"padding-left":"24px","padding-right":"24px"}},I={class:"center-align"},S={key:0},V={key:1},O={key:2,class:"center-align"},q={key:3,class:"center-align"},F={class:"center-align"},z={class:"tabbed"},G={style:{"max-height":"50vh",overflow:"scroll"}},T=["onClick"],Y={class:"max"},H={class:"small"},R={class:"link"},J={class:"max"},W={class:"small"},Z={class:"link"},x={id:"join-form",onsubmit:"event.preventDefault()"},K={class:"field label prefix border"},Q={class:"field label prefix suffix border"},X=["value"],M={key:0,class:"error"},_={class:"right-align"},ee={class:"right-align no-space"};function oe(n,e,t,v,s,u){const w=h("LoginButtons"),b=h("PrivacyPolicyLink");return a(),r(m,null,[o("main",D,[o("div",N,[o("article",E,[o("div",null,[o("div",{class:d(["page",{active:s.page==0}])},[e[15]||(e[15]=o("i",{class:"extra"},"groups",-1)),o("h5",I,i(n.$t("join.title")),1),s.name!=null?(a(),r("p",S,i(n.$t("join.message.specific",{n:s.host||n.$t("common.someone"),s:s.name})),1)):c("",!0),s.name==null?(a(),r("p",V,i(n.$t("join.message.generic",{n:s.host||n.$t("common.someone")})),1)):c("",!0),e[16]||(e[16]=o("div",{class:"space"},null,-1)),n.$ctx.currentUser.value!==void 0?(a(),r("nav",O,[o("button",{class:"large",onClick:e[0]||(e[0]=l=>u.join())},[e[10]||(e[10]=o("i",null,"join",-1)),o("span",null,i(n.$t("common.join")),1)])])):c("",!0),n.$ctx.currentUser.value==null?(a(),r("div",q,[o("button",{class:"responsive",onClick:e[1]||(e[1]=l=>u.join())},[e[11]||(e[11]=o("i",null,"join",-1)),o("span",null,i(n.$t("join.button.joinWithoutAccount")),1)]),e[12]||(e[12]=o("div",{class:"space"},null,-1)),e[13]||(e[13]=o("div",{class:"divider"},null,-1)),e[14]||(e[14]=o("div",{class:"space"},null,-1)),p(w,{"hide-anon":!0,reload:!0})])):c("",!0)],2),s.loaded?(a(),r("div",{key:0,class:d(["page",{active:s.page==1}])},[e[25]||(e[25]=o("i",{class:"extra"},"label",-1)),o("h5",F,i(n.$t("join.whoAreYou.title")),1),o("p",null,[f(i(n.$t("join.whoAreYou.message[0]")),1),e[17]||(e[17]=o("br",null,null,-1)),f(i(n.$t("join.whoAreYou.message[1]")),1)]),e[26]||(e[26]=o("div",{class:"space"},null,-1)),e[27]||(e[27]=o("div",{class:"space"},null,-1)),o("nav",z,[o("a",{class:d({active:s.secondaryPage==0}),onClick:e[2]||(e[2]=l=>s.secondaryPage=0)},[e[18]||(e[18]=o("i",null,"check_circle",-1)),o("span",null,i(n.$t("common.select")),1)],2),o("a",{class:d({active:s.secondaryPage==1}),onClick:e[3]||(e[3]=l=>s.secondaryPage=1)},[e[19]||(e[19]=o("i",null,"add",-1)),o("span",null,i(n.$t("common.add")),1)],2)]),e[28]||(e[28]=o("div",{class:"space"},null,-1)),e[29]||(e[29]=o("div",{class:"space"},null,-1)),n.$client.space!=null?(a(),r("div",{key:0,class:d(["page left center-align",{active:s.secondaryPage==0}])},[o("article",G,[(a(!0),r(m,null,y(n.$client.space.members,l=>(a(),r(m,null,[l.isOwner()?c("",!0):(a(),r("a",{key:0,class:"row wave padding",onClick:ne=>u.chooseMember(l)},[o("button",{class:d(["circle",[`${l.color}5`]])},e[20]||(e[20]=[o("i",{style:{color:"black"}},"person",-1)]),2),o("div",Y,[o("h6",H,i(l.name),1),o("div",null,[o("span",R,i(n.$tc("common.likes",l.likes.length))+" "+i(n.$t("common.and"))+" "+i(n.$tc("common.recommendations",l.suggestions.length)),1)])])],8,T))],64))),256)),o("a",{class:"row wave padding",onClick:e[4]||(e[4]=l=>s.secondaryPage=1)},[e[21]||(e[21]=o("button",{class:"circle"},[o("i",null,"add")],-1)),o("div",J,[o("h6",W,i(n.$tc("common.add")),1),o("div",null,[o("span",Z,i(n.$tc("join.whoAreYou.add")),1)])])])])],2)):c("",!0),o("div",{class:d(["page right center-align",{active:s.secondaryPage==1}])},[o("form",x,[o("div",K,[e[22]||(e[22]=o("i",null,"label",-1)),k(o("input",{type:"name","onUpdate:modelValue":e[5]||(e[5]=l=>s.form.name=l)},null,512),[[A,s.form.name]]),o("label",null,i(n.$t("common.name")),1)]),o("div",Q,[o("i",{class:d([`${s.form.color}-text`])},"palette",2),k(o("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.form.color=l)},[(a(!0),r(m,null,y(u.getAvailableColors(),l=>(a(),r("option",{value:l},i(u.getColorLabel(l)),9,X))),256))],512),[[L,s.form.color]]),o("label",null,i(n.$t("common.color")),1),e[23]||(e[23]=o("i",null,"arrow_drop_down",-1))])]),s.form.error!=null?(a(),r("p",M,i(s.form.error),1)):c("",!0),o("nav",_,[o("button",{form:"join-form",onClick:e[7]||(e[7]=l=>u.complete())},[e[24]||(e[24]=o("i",null,"check",-1)),o("span",null,i(n.$t("common.finish")),1)])])],2)],2)):c("",!0)])])])]),p(b),o("div",{class:d(["overlay",{active:s.errorCode}]),onClick:e[8]||(e[8]=l=>s.errorCode=void 0)},null,2),o("dialog",{class:d(["error",{active:s.errorCode}])},[o("h5",null,i(n.$t("join.dialog.error.title")),1),o("div",null,i(n.$t("join.dialog.error.message"))+" "+i(s.errorCode),1),o("nav",ee,[o("button",{class:"error-container no-elevate",onClick:e[9]||(e[9]=l=>s.errorCode=void 0)},i(n.$t("common.ok")),1)])],2)],64)}const ie=B(U,[["render",oe]]);export{ie as default};
